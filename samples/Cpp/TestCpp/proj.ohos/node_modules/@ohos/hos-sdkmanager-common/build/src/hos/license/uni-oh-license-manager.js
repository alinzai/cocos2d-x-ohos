"use strict";var __awaiter=this&&this.__awaiter||function(e,n,t,s){return new(t||(t=Promise))((function(o,i){function a(e){try{c(s.next(e))}catch(e){i(e)}}function r(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,r)}c((s=s.apply(e,n||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UniOhLicenseManager=void 0;const sdkmanager_common_1=require("@ohos/sdkmanager-common"),path_1=__importDefault(require("path")),uni_oh_component_constants_1=require("../const/uni-oh-component-constants"),hos_license_manager_1=require("./hos-license-manager");class UniOhLicenseManager extends sdkmanager_common_1.AbstractLicenseManager{constructor(e,n,t){super(),this._sdkSettings=e,this._axiosInstance=n,this._components=t}getLicensesRootLocation(){return path_1.default.resolve(this._sdkSettings.getLocation())}getReadLocalHashErrorMessage(e){return new sdkmanager_common_1.ErrorTip("Failed to read the license file.","The license file may be corrupted or missing.",`Delete the ${e} folder and       go to Tools > SDK Manager > SDKs > HarmonyOS to download any SDK. Open SDK Manager`).getMessage()}retrieveLicenses(e,n){return __awaiter(this,void 0,void 0,(function*(){const e=[],t=[];this._components.forEach((n=>{n.getApiVersion()===uni_oh_component_constants_1.GET_FROM_OHOS_SDK_API_VERSION?e.push(n):t.push(n)}));const s=new Map;if(0!==e.length){const t=e.map((e=>e.getLicense())),o=yield new sdkmanager_common_1.OhLicenseManager(this._sdkSettings,this._axiosInstance).retrieveLicenses(t,n);if(0===o.size)return new Map;o.forEach(((e,n)=>s.set(n,e)))}if(0!==t.length){const e=t.map((e=>e.getLicense())),o=yield new hos_license_manager_1.HosLicenseManager(this._sdkSettings,this._axiosInstance).retrieveLicenses(e,n);if(0===o.size)return new Map;o.forEach(((e,n)=>s.set(n,e)))}return s}))}}exports.UniOhLicenseManager=UniOhLicenseManager;
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,a)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TaskTree=void 0;const default_task_js_1=require("../../../external/task/default-task.js"),task_js_1=require("../../../external/task/task.js"),hvigor_log_js_1=require("../../../log/hvigor-log.js"),os=__importStar(require("os")),task_path_util_js_1=require("../util/task-path-util.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("no-pattern-info");class TaskTree extends default_task_js_1.DefaultTask{constructor(e){super(e,{name:"taskTree",group:task_js_1.Task.HELP_TASK_GROUP,isEnabled:!0,description:"Displays the task dag tree of the HvigorNode."})}registryAction(){return()=>{const e=["--------------------------------------------------------------------------",`All tasks dependencies from hvigor node '${this.node.getName()}'`,"--------------------------------------------------------------------------",""],t=this.node.getTaskGraph(),s=[];t.getAllStartNodes().forEach((e=>{const t=(0,task_path_util_js_1.getTaskNameFromTaskPath)(e),r=this.node.getTaskByName(t);r.getGroup()!==task_js_1.Task.HELP_TASK_GROUP&&r.getGroup()!==task_js_1.Task.SYNC_TASK_GROUP&&s.push(this.node.getTaskByName(t))}));for(const t of s){const s=t.getName();e.push(`:${this.node.getName()}:${s}`),this.renderTaskGraph(t.getDependsOn(),e,0)}log.info(e.join(os.EOL))}}renderTaskGraph(e,t,s){for(const r of e){const e=(0,task_path_util_js_1.getTaskNameFromTaskPath)(r);if((0,task_path_util_js_1.getModuleNameFromTaskPath)(r)!==this.node.getName()){t.push(`${this.getEndNodePrefix(s)}${r}`);continue}const a=this.node.getTaskByName(e);void 0===a||0===a.getDependsOn().length?t.push(`${this.getEndNodePrefix(s)}${a.getName()}`):(t.push(`${this.getExpandNodePrefix(s)}${a.getName()}`),this.renderTaskGraph(a.getDependsOn(),t,s+1))}}getEndNodePrefix(e){let t="";for(let s=0;s<e;s++)t+="    ";return`${t}\\--- :`}getExpandNodePrefix(e){let t="";for(let s=0;s<e;s++)t+="    ";return`${t}+--- :`}}exports.TaskTree=TaskTree;
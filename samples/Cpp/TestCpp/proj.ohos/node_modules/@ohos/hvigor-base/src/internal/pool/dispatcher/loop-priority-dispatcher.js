"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LoopPriorityDispatcher=void 0;const log_js_1=require("../log-collection/log.js"),tcb_store_js_1=require("../store/tcb-store.js"),cpu_js_1=require("../../../util/cpu.js"),constant_js_1=require("../constant/constant.js");class LoopPriorityDispatcher{dispatch(t,e,r,o){if(e.empty())return!1;if(cpu_js_1.cpuUsage>=constant_js_1.PoolConstant.CPU_LIMIT)return setTimeout((()=>{this.dispatch(t,e,r,o)}),constant_js_1.PoolConstant.FAIL_DISPATCH_INTERVAL),!1;const s=e,i=e=>{if(r.isBusyWorker(e)||!r.isIdleWorker(e)&&!r.createWorker(e))return!1;const o=s.getFirstWaitingWork(e);return!!o&&(r.doWork(o,tcb_store_js_1.TcbStore.getTCB(o.getId()).getCallback(),tcb_store_js_1.TcbStore.getTCB(o.getId()).getCallbackInput(),e)?(tcb_store_js_1.TcbStore.getTCB(o.getId()).isWarmUp()||t.addLog((0,log_js_1.generateScheduleLog)(`${Date.now()}`,o.getId(),e)),!0):(s.pushWork(o,e),!1))};if(void 0!==o)return i(o);for(let t=0;t<r.getMaxPoolNum();t++)if(i(t))return!0;return!1}}exports.LoopPriorityDispatcher=LoopPriorityDispatcher;
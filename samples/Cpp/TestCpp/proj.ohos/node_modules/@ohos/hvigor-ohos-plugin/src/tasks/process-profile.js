"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProcessProfile=void 0;const fs=__importStar(require("fs-extra")),ohos_hap_task_js_1=require("./task/ohos-hap-task.js"),project_file_reader_js_1=require("../utils/project-file-reader.js"),merge_profile_js_1=require("./merge-profile.js"),task_names_js_1=require("./common/task-names.js");var Task=task_names_js_1.TaskNames.Task;const file_set_js_1=require("@ohos/hvigor-base/src/internal/snapshot/util/file-set.js"),virtual_machine_enum_js_1=require("../enum/virtual-machine-enum.js"),INPUT_KEY={arkEnable:"arkEnable",compileMode:"compileMode",deviceTypes:"deviceTypes"};class ProcessProfile extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,Task.PROCESS_PROFILE),this._arkEnable=this.service.isArkModule(),this._compileMode=this.moduleModel.getCompileMode(),this._moduleTargetData=this.targetService.getTargetData(),this._deviceTypes=this._moduleTargetData.getTargetDeviceType(),this._pathInfo=this._moduleTargetData.getPathInfo(),this._intermediatesMergeProfile=this._pathInfo.getIntermediatesMergeProfile(),this._processedModuleJson=this._pathInfo.getIntermediatesProcessProfile()}initTaskDepends(){this.module.registryDependsOnTask(this,new merge_profile_js_1.MergeProfile(this.targetService))}doTaskAction(e){const t=project_file_reader_js_1.ProjectFileReader.getJson5Obj(this._intermediatesMergeProfile);t.module.virtualMachine=this._arkEnable?`${virtual_machine_enum_js_1.VirtualMachine.ARK}${this.sdkInfo.getArkVersion()}`:virtual_machine_enum_js_1.VirtualMachine.DEFAULT,t.module.compileMode=this._compileMode,t.module.deviceTypes=this._deviceTypes,fs.outputJSONSync(this._processedModuleJson,t,{spaces:"\t"})}declareInputs(){const e=new Map;return e.set(INPUT_KEY.arkEnable,this._arkEnable),e.set(INPUT_KEY.compileMode,this._compileMode),e.set(INPUT_KEY.deviceTypes,this._deviceTypes),e}declareInputFiles(){return(new file_set_js_1.FileSet).addEntry(this._intermediatesMergeProfile)}declareOutputFiles(){return(new file_set_js_1.FileSet).addEntry(this._processedModuleJson)}}exports.ProcessProfile=ProcessProfile;
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractHosRemoteComponentLoader=void 0;const sdkmanager_common_1=require("@ohos/sdkmanager-common"),hos_biz_util_1=require("../util/hos-biz-util"),hos_component_dto_1=require("./hos-component-dto");class AbstractHosRemoteComponentLoader extends sdkmanager_common_1.AbstractComponentLoader{constructor(e,t,o){super(o),this.settings=e,this.axiosInstance=t}load(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.settings.getGrsService();if(!e)return this.progress.warn("Failed to request remote HarmonyOS SDK, grsService is undefined"),[];const t=(0,hos_biz_util_1.getQueryMetaUrl)(e),o=(yield this.axiosInstance.post(t,this.createReqParam(),this._configHeader())).data;if(!o)return this.progress.warn("Failed to request remote HarmonyOS SDK, result is empty"),[];const n=[];for(const e of o){if(!this._shouldShow(e))continue;const t=this.convertComponent(e);this.isValidComponent(t)&&this.addComponent(n,t)}return n}catch(e){this.progress.warn(e)}return[]}))}_configHeader(){return{headers:{AppId:"DevEcoStudio_Lib",Version:"0.0.0.1"}}}_shouldShow(e){return e.experimentalFlag===Experimental.NO}convertComponent(e){var t,o,n,i;const r=new hos_component_dto_1.HosComponentDto;Object.assign(r,e);const s=Number(e.apiVersion);Number.isNaN(s)||(r.apiVersion=s);const a=new hos_component_dto_1.HosArchiveDto;let c=Number(null===(o=null===(t=null==e?void 0:e.archive)||void 0===t?void 0:t.complete)||void 0===o?void 0:o.size);return Number.isNaN(c)&&(c=0),a.complete={size:c,checksum:null===(i=null===(n=null==e?void 0:e.archive)||void 0===n?void 0:n.complete)||void 0===i?void 0:i.checksum},r.archive=a,r.displayName=this.convertDisplayName(r),r.location=this.getLocation(r,this.settings.getLocation()),r}addComponent(e,t){e.push(t)}}var Experimental;exports.AbstractHosRemoteComponentLoader=AbstractHosRemoteComponentLoader,function(e){e.YES="1",e.NO="0"}(Experimental||(Experimental={}));
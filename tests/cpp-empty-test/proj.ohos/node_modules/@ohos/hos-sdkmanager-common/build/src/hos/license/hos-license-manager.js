"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function i(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((s=s.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HosLicenseManager=void 0;const sdkmanager_common_1=require("@ohos/sdkmanager-common"),hos_biz_util_1=require("../util/hos-biz-util"),path_1=__importDefault(require("path"));class HosLicenseManager extends sdkmanager_common_1.AbstractLicenseManager{constructor(e,t){super(),this._sdkSettings=e,this._axiosInstance=t}getLicensesRootLocation(){return path_1.default.resolve(this._sdkSettings.getLocation())}getReadLocalHashErrorMessage(e){return new sdkmanager_common_1.ErrorTip("Failed to read the license file.","The license file may be corrupted or missing.",`Delete the ${e} folder and       go to Tools > SDK Manager > SDKs > HarmonyOS to download any SDK. Open SDK Manager`).getMessage()}retrieveLicenses(e,t){return __awaiter(this,void 0,void 0,(function*(){const n=new Map;try{const t=yield this._sdkSettings.getGrsService(),s=(0,hos_biz_util_1.getSdkLicenseUrl)(t),o=(yield this._axiosInstance.post(s,this._createLicenseReqDto(e))).data;if(o)for(const e of o){const t={id:e.name,content:e.content};n.set(e.name,t)}}catch(e){t.warn(`Failed to request HarmonyOS SDK license, ${e}`)}return n}))}_createLicenseReqDto(e){return{language:"en",licenseIds:e,countryCode:this._sdkSettings.getCountry()}}}exports.HosLicenseManager=HosLicenseManager;
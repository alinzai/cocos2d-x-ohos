"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleModelImpl=void 0;const ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),validate_util_js_1=require("../../utils/validate-util.js"),target_source_set_impl_js_1=require("../source-set/target-source-set-impl.js"),path_1=__importDefault(require("path")),module_type_enum_js_1=require("../../enum/module-type-enum.js"),core_module_model_impl_js_1=require("./core-module-model-impl.js"),common_const_js_1=require("../../const/common-const.js"),array_util_js_1=require("../../utils/array-util.js"),defaultTargetName=common_const_js_1.DefaultTargetConst.DEFAULT_TARGET,ohosTestTargetName=common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET,_log=ohos_logger_js_1.OhosLogger.getLogger("moduleModel");class ModuleModelImpl extends core_module_model_impl_js_1.CoreModuleModelImpl{getDeviceTypes(){return this.getSourceSetByTargetName().getModuleTargetRes().getModuleJsonOpt().module.deviceTypes}constructor(e,t){super(e,t)}initDefaultTargetSourceSet(){const e=new target_source_set_impl_js_1.TargetSourceSetImpl(path_1.default.resolve(this._sourceRootDir,"main"));this.targetSourceSetMap.set(defaultTargetName,e);if((0,array_util_js_1.getElementFromArr)(this.getProfileOpt().targets,ohosTestTargetName)){const e=new target_source_set_impl_js_1.TargetSourceSetImpl(path_1.default.resolve(this._sourceRootDir,ohosTestTargetName));this.targetSourceSetMap.set(common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET,e)}}getModuleType(){var e;const t=this.getSourceSetByTargetName(),o=null===(e=t.getModuleTargetRes().getModuleJsonOpt().module)||void 0===e?void 0:e.type;return void 0===o&&_log._buildError("Unable to obtain the module type.")._solution("Make sure the module/type field is set correctly in the module.json5 file: ")._file(t.getModuleTargetRes().getJsonPath())._printErrorAndExit(),module_type_enum_js_1.ModuleType.valueOf(o)}getSourceSetByTargetName(e=defaultTargetName){return this.targetSourceSetMap.has(e)?this.targetSourceSetMap.get(e):this.targetSourceSetMap.get(defaultTargetName)}getJsonObjByTargetName(e){return this.getSourceSetByTargetName(e).getModuleTargetRes().getModuleJsonOpt()}getJsonPathByTargetName(e){return this.getSourceSetByTargetName(e).getModuleTargetRes().getJsonPath()}isAtomicService(){var e,t;return this.isInstallFree()||(null===(t=null===(e=this.getJsonObjByTargetName(defaultTargetName).module)||void 0===e?void 0:e.extensionAbilities)||void 0===t?void 0:t.some((e=>"form"===e.type)))||!1}isInstallFree(){return this.getJsonObjByTargetName(defaultTargetName).module.installationFree||!1}getFormJsonObjByTargetName(e,t){const o=this.getSourceSetByTargetName(e).getModuleTargetRes().getFormJsonOpt(t);return validate_util_js_1.ValidateUtil.validateDuplicatedName(o.forms,"Form",t),o}}exports.ModuleModelImpl=ModuleModelImpl;
"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReplacePreviewerPage=void 0;const ohos_hap_task_js_1=require("../task/ohos-hap-task.js"),inject_const_js_1=require("../../const/inject-const.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),fs_extra_1=__importDefault(require("fs-extra")),preview_hook_compile_resource_js_1=require("../hook/preview-hook-compile-resource.js"),hvigor_base_1=require("@ohos/hvigor-base"),path_1=__importDefault(require("path"));var CommonTask=task_names_js_1.TaskNames.CommonTask;class ReplacePreviewerPage extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,CommonTask.REPLACE_PREVIEWER_PAGES),this._log=ohos_logger_js_1.OhosLogger.getLogger(ReplacePreviewerPage.name)}initTaskDepends(){this.node.registryDependsOnTask(this,new preview_hook_compile_resource_js_1.PreviewHookCompileResource(this.targetService))}doTaskAction(e){this.processPreviewProfile(e,this._log)}processPreviewProfile(e,s){if(this.replacePreviewPage(s))return;"true"===hvigor_base_1.hvigor.getExtraConfig().get(inject_const_js_1.InjectConst.PREVIEWER_COMPILE_RES_INC)&&this.copyProfile(e)}replacePreviewPage(e){const s=hvigor_base_1.hvigor.getExtraConfig().get(inject_const_js_1.InjectConst.PREVIEWER_REPLACE_PAGE);return!!s&&(this.replacePages(e,[s]),!0)}copyProfile(e){const s=path_1.default.resolve(e.getModuleModel().getSourceRootByTargetName(e.getModuleModel().getName()),build_directory_const_js_1.BuildDirConst.RESTOOL_BUILD_RESOURCES,build_directory_const_js_1.BuildDirConst.BASE,build_directory_const_js_1.BuildDirConst.PROFILE),o=path_1.default.resolve(e.getPathInfo().getIntermediatesRes(),build_directory_const_js_1.BuildDirConst.RESTOOL_BUILD_RESOURCES,build_directory_const_js_1.BuildDirConst.BASE,build_directory_const_js_1.BuildDirConst.PROFILE);fs_extra_1.default.mkdirsSync(o),fs_extra_1.default.existsSync(s)&&fs_extra_1.default.copySync(s,o,{recursive:!0})}}exports.ReplacePreviewerPage=ReplacePreviewerPage;
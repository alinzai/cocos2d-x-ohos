"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleTargetData=void 0;const build_directory_const_js_1=require("../../const/build-directory-const.js"),status_js_1=require("../service/status.js"),array_util_js_1=require("../../utils/array-util.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),default_plugin_id_js_1=require("../../plugin/common/default-plugin-id.js"),target_validate_util_js_1=require("../service/util/target-validate-util.js"),runtime_type_enum_js_1=require("../../enum/runtime-type-enum.js");class ModuleTargetData{constructor(e,t,r,i){this._moduleModel=e,this._target=t,this._pathInfo=r,this._product=i;const o=new status_js_1.Status(t);this._targetStatus=0===o.getStatusCode()?new status_js_1.Status(e.getProfileOpt()):o,this._moduleSourceSetModel=this._moduleModel.getSourceSetByTargetName(t.name),(0,target_validate_util_js_1.validateHosApi9AtomicService)(e,t,this.isHarmonyOS())}isHarmonyOS(){return this._targetStatus.is(runtime_type_enum_js_1.RuntimeTypeEnum.HARMONY_OS)}getModuleModel(){return this._moduleModel}getModuleSourceSetModel(){return this._moduleSourceSetModel}getRelatedEntryModules(){return this.getModuleModel().getRelatedEntryModules()}getTargetName(){return this._target.name}getTargetOpt(){return this._target}getPathInfo(){return this._pathInfo}getModuleTargetOutputFileName(e,t,r=build_directory_const_js_1.BuildArtifactExtension.DOT_HAP){const i=this._moduleModel.getName(),o=""===e?"":`-${e}`;if(null===t)return`${i}${o}-${this._target.name}${r}`;const s=t?"signed":"unsigned";return`${i}${o}-${this._target.name}-${s}${r}`}getApkName(e=!1){const t=this._moduleModel.getModuleType(this.getTargetName());return e?`${this._moduleModel.getName()}-${this._target.name}-cut-${t}.apk`:`${this._moduleModel.getName()}-${this._target.name}-${t}.apk`}getTargetStatus(){return this._targetStatus}getProduct(){return this._product}findTargetDataByName(e){var t;const r=this._moduleModel.getModule().findModuleByName(e);if(void 0===r)return;return null===(t=r.getPluginById(default_plugin_id_js_1.DefaultPluginId.OHOS_HAP_PLUGIN).getTaskService())||void 0===t?void 0:t.findTargetDataByName(this.getTargetName())}findTargetConfigOpt(e){var t;return(0,array_util_js_1.getElementFromArr)(null===(t=this.getTargetOpt().source)||void 0===t?void 0:t.abilities,e.getName())}getTargetDeviceType(){var e;const t=null===(e=this.getTargetOpt().config)||void 0===e?void 0:e.deviceType;return void 0===t||0===t.length?this._moduleModel.getDeviceTypes():(t.every((e=>this._moduleModel.getDeviceTypes().includes(e)))||ohos_logger_js_1.OhosLogger.getLogger("target")._buildError("Invalid target deviceType.")._solution(`Make sure the deviceType field for the '${this.getTargetName()}' target in the build-profile.json5 file is a subset of deviceType of the module.`)._file(this._moduleModel.getProfilePath())._printErrorAndExit(this._moduleModel.getName()),t)}}exports.ModuleTargetData=ModuleTargetData;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TaskUpToDatedListener=exports.TaskDisabledListener=exports.TaskFailedListener=exports.TaskFinishedListener=exports.WorkFailedListener=exports.WorkFinishedListener=void 0;const task_control_center_js_1=require("../task-control-center.js"),time_util_js_1=require("../../../../util/time-util.js"),util_js_1=require("../../../../util/util.js"),hvigor_log_js_1=require("../../../../log/hvigor-log.js"),task_listener_event_id_js_1=require("./task-listener-event-id.js"),task_util_js_1=require("../../../../util/task-util.js"),hvigor_process_js_1=require("../../../lifecycle/hvigor-process.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("hvigor-task-control-center-listener");class DefaultTaskControlCenterListener{constructor(e){this.taskControlCenter=e}}class WorkFinishedListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e){void 0!==e&&e.taskExecutedStatus.allWorksHasFinished()&&task_control_center_js_1.taskControlCenter.emit(task_listener_event_id_js_1.TASK_CENTER_TASK_EVENT_ID.TASK_FINISHED,e.getPath())}}exports.WorkFinishedListener=WorkFinishedListener;class WorkFailedListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e,t){task_control_center_js_1.taskControlCenter.emit(task_listener_event_id_js_1.TASK_CENTER_TASK_EVENT_ID.TASK_FAILED,e.getPath()),t[0]instanceof Error&&hvigor_process_js_1.hvigorProcess.error(t[0])}}exports.WorkFailedListener=WorkFailedListener;class TaskFinishedListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e){e.metric.close(),(0,task_util_js_1.markTaskExecuteSuccessful)(e);const t=process.hrtime(e.taskExecutedStatus.getTaskBeginTime()),s=(0,time_util_js_1.formatTime)(t);log._printTaskExecuteInfo(e.getPath(),s),(0,util_js_1.recordTraceData)(e.getName(),1e9*t[0]+t[1]),task_control_center_js_1.taskControlCenter.setTaskExecuted(e.getPath())}}exports.TaskFinishedListener=TaskFinishedListener;class TaskFailedListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e){e.metric.close(),task_control_center_js_1.taskControlCenter.clearRunnableTaskQueue(),task_control_center_js_1.taskControlCenter.clearInterval(),log._printFailedTaskInfo(e.getPath())}}exports.TaskFailedListener=TaskFailedListener;class TaskDisabledListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e){log._printDisabledTaskInfo(e.getPath()),task_control_center_js_1.taskControlCenter.setTaskExecuted(e.getPath())}}exports.TaskDisabledListener=TaskDisabledListener;class TaskUpToDatedListener extends DefaultTaskControlCenterListener{constructor(e){super(e)}executeListener(e){e.metric.close(),(0,task_util_js_1.markTaskExecuteSuccessful)(e),log._printUpToDateTaskInfo(e.getPath()),task_control_center_js_1.taskControlCenter.setTaskExecuted(e.getPath())}}exports.TaskUpToDatedListener=TaskUpToDatedListener;
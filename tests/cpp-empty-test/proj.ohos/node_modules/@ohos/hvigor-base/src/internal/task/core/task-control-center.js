"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.taskControlCenter=exports.TaskControlCenter=void 0;const task_queue_js_1=require("./task-queue.js"),events_1=__importDefault(require("events")),task_directed_acyclic_graph_js_1=require("./task-directed-acyclic-graph.js"),task_util_js_1=require("../util/task-util.js");class TaskControlCenter extends events_1.default{constructor(){super(),this.blockedTaskMap=new Map,this.runnableTaskQueue=new task_queue_js_1.TaskQueue,this.runningTaskList=new Map}initTaskQueueBeforeRun(e){e.forEach((e=>{this.initTaskQueueForOneTask((0,task_util_js_1.findTaskByPath)(e))}))}initTaskQueueForOneTask(e){const t=[...task_directed_acyclic_graph_js_1.projectTaskDag.getChildren(e.getPath()).values()];this.blockedTaskMap.set(e.getPath(),t.length),0===t.length?this.runnableTaskQueue.push(e):t.forEach((e=>{this.blockedTaskMap.has(e)||this.initTaskQueueForOneTask((0,task_util_js_1.findTaskByPath)(e))}))}clearRunnableTaskQueue(){this.runnableTaskQueue.clear()}allTasksHasExecuted(){return 0===this.blockedTaskMap.size}popRunnableTask(){return this.runnableTaskQueue.pop()}getRunnableTaskSize(){return this.runnableTaskQueue.size()}setTaskExecuted(e){this.blockedTaskMap.delete(e);task_directed_acyclic_graph_js_1.projectTaskDag.getParent(e).forEach((e=>{if(!this.blockedTaskMap.has(e))return;const t=this.blockedTaskMap.get(e)-1;this.blockedTaskMap.set(e,t),0===t&&this.runnableTaskQueue.push((0,task_util_js_1.findTaskByPath)(e))}))}pushRunningTask(e){this.runningTaskList.set(e.getPath(),e)}getRunningTask(e){return this.runningTaskList.get(e)}setIntervalId(e){this.intervalId=e}clearInterval(){clearInterval(this.intervalId)}}exports.TaskControlCenter=TaskControlCenter,exports.taskControlCenter=new TaskControlCenter;
"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hvigorProcess=exports.HvigorProcess=exports.HVIGOR_PROCESS_STATE=void 0;const events_1=__importDefault(require("events")),init_js_1=require("./init.js"),configuration_js_1=require("./configuration.js"),build_task_graph_js_1=require("./build-task-graph.js"),execute_mode_factory_js_1=require("./execute/mode/execute-mode-factory.js"),process_1=__importDefault(require("process")),hvigor_process_listener_factory_js_1=require("./listener/hvigor-process-listener-factory.js"),hvigor_log_js_1=require("../../log/hvigor-log.js"),global_data_js_1=require("../data/global-data.js"),index_js_1=require("../../../index.js"),event_id_options_js_1=require("./event/event-id-options.js"),cli_options_js_1=require("../../util/options/cli-options.js"),modeAlias=cli_options_js_1.cliOptions.mode.alias;exports.HVIGOR_PROCESS_STATE={RUNNING:0,END:1,CANCELED:2};const _log=hvigor_log_js_1.HvigorLogger.getLogger("hvigor-process");class HvigorProcess extends events_1.default{constructor(){super(),this.hasTaskDone=!1}init(){this.once(event_id_options_js_1.HVIGOR_PROCESS_EVENT_ID.FINISHED,(()=>{hvigor_process_listener_factory_js_1.hvigorProcessListenerFactory.getProcessListenerByEventName(event_id_options_js_1.HVIGOR_PROCESS_EVENT_ID.FINISHED)()})),this.once(event_id_options_js_1.HVIGOR_PROCESS_EVENT_ID.FAILED,(()=>{hvigor_process_listener_factory_js_1.hvigorProcessListenerFactory.getProcessListenerByEventName(event_id_options_js_1.HVIGOR_PROCESS_EVENT_ID.FAILED)()}))}start(){const e=global_data_js_1.globalData.cliOpts,s=global_data_js_1.globalData.cliEnv;this.taskBeginTime=process_1.default.hrtime(),(0,init_js_1.init)();const o=(0,configuration_js_1.configuration)();(0,build_task_graph_js_1.buildTaskGraph)(o);const r={toRunTasks:e._,isNeedSync:e.sync},t=s.configProps.get(modeAlias);new execute_mode_factory_js_1.ExecuteModeFactory(o,r).getExecutePipeline(t).startPipeline()}close(){_log.debug("hvigor process will be closed.")}error(e){_log.debug("hvigor process will be closed with an error."),_log.error(e.message),index_js_1.hvigor.startParameters.printStackTrace&&_log.error(e.stack),exports.hvigorProcess.emit(event_id_options_js_1.HVIGOR_PROCESS_EVENT_ID.FAILED)}}exports.HvigorProcess=HvigorProcess,exports.hvigorProcess=new HvigorProcess;